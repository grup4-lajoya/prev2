<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Control de Rancho</title>
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS para Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="css/control-rancho.css">
</head>
<body>

<div class="container">
  <h1>ğŸ“Š Control de Rancho</h1>
  
  <!-- FILTROS -->
  <div class="panel-filtros">
    <div class="filtro-grupo">
      <label>Fecha Inicio <span class="required">*</span></label>
      <input type="date" id="fechaInicio" required>
    </div>
    
    <div class="filtro-grupo">
      <label>Fecha Fin <span class="required">*</span></label>
      <input type="date" id="fechaFin" required>
    </div>
    
    <div class="filtro-grupo">
      <label>Tipo de RaciÃ³n</label>
      <select id="tipoRacion">
        <option value="">Todos</option>
        <option value="DESAYUNO">Desayuno</option>
        <option value="ALMUERZO">Almuerzo</option>
        <option value="CENA">Cena</option>
      </select>
    </div>
    
    <div class="filtro-grupo">
      <label>Tipo de Personal</label>
      <select id="tipoPersonal">
        <option value="">Todos</option>
        <option value="PERSONAL_UNIDAD">Personal de la Unidad</option>
        <option value="EVENTO">Personal de Evento</option>
        <option value="FORANEO">ForÃ¡neos/Civiles</option>
      </select>
    </div>
        <div class="filtro-grupo">
      <label>Estado Reserva</label>
      <select id="estadoReserva">
        <option value="CONSUMIDO">Solo Consumidos</option>
        <option value="CONFIRMADO">Solo Confirmados (No consumidos)</option>
        <option value="AMBOS">Todos</option>
      </select>
    </div>
    
    <div class="filtro-acciones">
      <button class="btn-filtrar" onclick="aplicarFiltros()">
        ğŸ“Š Actualizar
      </button>
      <button class="btn-exportar" onclick="exportarExcel()">
        ğŸ“¥ Exportar Excel
      </button>
      <button class="btn-exportar" onclick="exportarExcelFinanzas()" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);">
        ğŸ’° Exportar Excel (Finanzas)
      </button>
    </div>
  </div>
  
  <!-- RESUMEN GENERAL -->
  <div class="resumen-cards">
    <div class="card-stat">
      <div class="stat-icon">â˜•</div>
      <div class="stat-info">
        <span class="stat-valor" id="totalDesayunos">0</span>
        <span class="stat-label">Desayunos</span>
      </div>
    </div>
    
    <div class="card-stat">
      <div class="stat-icon">ğŸ½ï¸</div>
      <div class="stat-info">
        <span class="stat-valor" id="totalAlmuerzos">0</span>
        <span class="stat-label">Almuerzos</span>
      </div>
    </div>
    
    <div class="card-stat">
      <div class="stat-icon">ğŸŒ™</div>
      <div class="stat-info">
        <span class="stat-valor" id="totalCenas">0</span>
        <span class="stat-label">Cenas</span>
      </div>
    </div>
    
    <div class="card-stat">
      <div class="stat-icon">ğŸ“ˆ</div>
      <div class="stat-info">
        <span class="stat-valor" id="totalGeneral">0</span>
        <span class="stat-label">Total Consumos</span>
      </div>
    </div>
  </div>
  
  <!-- GRÃFICAS -->
  <div class="graficas-grid">
    <div class="grafica-card">
      <h3>ğŸ¥§ Consumo por Tipo de RaciÃ³n</h3>
      <canvas id="chartTipoRacion"></canvas>
    </div>
    
    <div class="grafica-card">
      <h3>ğŸ“Š Programado vs Consumido</h3>
      <canvas id="chartComparacion"></canvas>
    </div>
    
    <div class="grafica-card">
      <h3>ğŸ‘¥ Por Tipo de Personal</h3>
      <canvas id="chartTipoPersonal"></canvas>
    </div>
    
    <div class="grafica-card">
      <h3>ğŸ“ˆ Tendencia por Fecha</h3>
      <canvas id="chartTendencia"></canvas>
    </div>
  </div>
  
  <!-- TABLA DETALLE -->
  <div class="tabla-detalle">
    <h3>ğŸ“‹ Detalle por CÃ³digo de MenÃº</h3>
    <div class="info-tabla">
      <span id="infoRegistros">0 registros</span>
    </div>
    <div class="tabla-container">
      <table id="tablaDetalle">
        <thead>
          <tr>
            <th>Tipo RaciÃ³n</th>
            <th>CÃ³digo MenÃº</th>
            <th>Unidad</th>
            <th>Evento</th>
            <th>Plana</th>
            <th>Cantidad</th>
          </tr>
        </thead>
        <tbody id="cuerpoTablaDetalle"></tbody>
      </table>
    </div>
  </div>
    <div class="tabla-detalle" style="margin-top: 30px;">
    <h3>ğŸ’° Detalle por Persona (Finanzas)</h3>
    <div class="info-tabla">
      <span id="infoRegistrosFinanzas">0 registros</span>
    </div>
    <div class="tabla-container">
      <table id="tablaDetalleFinanzas">
        <thead>
          <tr>
            <th>NSA</th>
            <th>Nombre</th>
            <th>Unidad</th>
            <th>Plana</th>
            <th>Evento</th>
            <th>Fecha</th>
            <th>Tipo RaciÃ³n</th>
            <th>CÃ³digo MenÃº</th>
            <th>Estado</th>
            <th>Fecha Consumo</th>
          </tr>
        </thead>
        <tbody id="cuerpoTablaFinanzas"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- OVERLAY DE CARGA -->
<div id="overlayGlobal" class="overlay-carga">
  <div class="overlay-content">
    <div class="spinner"></div>
    <p id="mensajeCarga">Cargando datos...</p>
  </div>
</div>

<script src="js/control-rancho.js"></script>
</body>
</html>

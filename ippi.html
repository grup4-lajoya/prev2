<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPPI - Informes de Peligros Potenciales e Incidentes</title>
<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="stylesheet" href="css/ippi.css">
</head>
<body>

<div class="container">
  <h1>IPPI - Informes de Peligros Potenciales e Incidentes</h1>
  
  <div class="buscador">
    <input type="text" id="buscar" placeholder="Buscar por asunto, lugar o fecha...">
    <select id="filtroEstado" onchange="aplicarFiltros()">
      <option value="">Todos los estados</option>
      <option value="Abierto">Abierto</option>
      <option value="En proceso">En proceso</option>
      <option value="Cerrado">Cerrado</option>
    </select>
    <span class="info-registros" id="infoRegistros"></span>
  </div>

  <div class="tabla-container">
    <div class="loading" id="loading">Cargando datos...</div>
    <table id="tablaIPPI" style="display:none;">
      <thead>
        <tr>
          <th>N°</th>
          <th>FECHA Y HORA</th>
          <th>ASUNTO</th>
          <th>LUGAR</th>
          <th>DESCRIPCIÓN</th>
          <th>REPORTA</th>
          <th>ESTADO</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla"></tbody>
    </table>
  </div>

  <div class="paginacion" id="paginacion" style="display:none;"></div>
</div>

<div id="overlayGlobal" class="overlay-carga">
  <div class="overlay-content">
    <div class="spinner"></div>
    <p id="mensajeCarga">Procesando...</p>
  </div>
</div>

<!-- MODAL VER DETALLE -->
<div id="modalVerDetalle" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2>👁 Ver Detalle del IPPI</h2>
      <span class="close" onclick="cerrarModalVerDetalle()">&times;</span>
    </div>
    <div class="modal-body">
      
      <div class="seccion info-jia">
        <div class="seccion-titulo">📋 Información del Informe</div>
        <div class="info-grid">
          <div class="info-item"><strong>Fecha y Hora:</strong><span id="verFecha">-</span></div>
          <div class="info-item"><strong>Asunto:</strong><span id="verAsunto">-</span></div>
          <div class="info-item"><strong>Lugar:</strong><span id="verLugar">-</span></div>
          <div class="info-item"><strong>Reporta:</strong><span id="verReporta">-</span></div>
          <div class="info-item"><strong>Estado:</strong><span id="verEstado">-</span></div>
        </div>
        
        <div class="info-descripcion">
          <strong>Descripción:</strong>
          <p id="verDescripcion">-</p>
        </div>

        <div class="info-descripcion">
          <strong>Recomendaciones:</strong>
          <p id="verRecomendaciones">-</p>
        </div>

        <div class="info-descripcion">
          <strong>Acciones Tomadas:</strong>
          <p id="verAccionesTomadas">-</p>
        </div>

        <div id="verSeccionImagenes" style="display:none;">
          <strong>Imágenes:</strong>
          <div id="verImagenes" class="imagenes-grid"></div>
        </div>
      </div>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalVerDetalle()">Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR -->
<div id="modalEditar" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>✏️ Editar IPPI</h2>
      <span class="close" onclick="cerrarModalEditar()">&times;</span>
    </div>
    <div class="modal-body">
      
      <input type="hidden" id="editFila">
      
      <div class="form-group">
        <label>Estado <span class="required">*</span></label>
        <select id="editEstado" required>
          <option value="Abierto">Abierto</option>
          <option value="En proceso">En proceso</option>
          <option value="Cerrado">Cerrado</option>
        </select>
      </div>

      <div class="form-group">
        <label>Acciones Tomadas</label>
        <textarea id="editAccionesTomadas" rows="6"></textarea>
      </div>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalEditar()">Cancelar</button>
      <button type="button" class="btn-guardar-cabecera" onclick="guardarEdicion()" id="btnGuardarEdicion">💾 Guardar Cambios</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIRMACIÓN -->
<div id="modalConfirmacion" class="modal-confirmacion">
  <div class="modal-confirmacion-content">
    <div class="modal-confirmacion-header">
      <span id="tituloConfirmacion">Confirmar acción</span>
    </div>
    <div class="modal-confirmacion-body">
      <p id="mensajeConfirmacion">¿Está seguro de realizar esta acción?</p>
    </div>
    <div class="modal-confirmacion-footer">
      <button class="btn-confirmar-no" onclick="cerrarConfirmacion(false)">No, Cancelar</button>
      <button class="btn-confirmar-si" onclick="cerrarConfirmacion(true)">Sí, Continuar</button>
    </div>
  </div>
</div>

<!-- MODAL IMAGEN -->
<div id="imageModal" class="modal" style="background-color: rgba(0,0,0,0.95);">
  <span class="close" onclick="cerrarModalImagen()">&times;</span>
  <div id="modalLoading" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:white;font-size:1.2rem;text-align:center;z-index:10000;">
    <div style="margin-bottom: 15px;">Cargando imagen...</div>
    <div class="spinner" style="border-color: #f3f3f3; border-top-color: white; margin: 0 auto;"></div>
  </div>
  <img id="modalImage" style="display:none;margin:auto;max-width:90%;max-height:90vh;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);border-radius:4px;object-fit:contain;z-index:10000;">
</div>

<script src="js/ippi.js"></script>
</body>
</html>

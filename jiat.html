<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JIAT - Información de las Juntas de Investigación de Accidentes Terrestres</title>
<link rel="stylesheet" href="css/jiat.css">
</head>
<body>

<div class="container">
  <h1>JIAT - Información de las Juntas de Investigación de Accidentes Terrestres</h1>
  
  <div class="buscador">
    <input type="text" id="buscar" placeholder="Buscar por unidad, código o fecha...">
    <span class="info-registros" id="infoRegistros"></span>
  </div>

  <div class="tabla-container">
    <div class="loading" id="loading">Cargando datos...</div>
    <table id="tablaJIAT" style="display:none;">
      <thead>
        <tr>
          <th>N°</th>
          <th>UNIDAD</th>
          <th>CÓDIGO</th>
          <th>FECHA</th>
          <th>FATAL</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla">
      </tbody>
    </table>
  </div>

  <div class="paginacion" id="paginacion" style="display:none;"></div>
</div>

<button class="btn-flotante" onclick="nuevoRegistro()" title="Nuevo Registro">+</button>

<div id="overlayGlobal" class="overlay-carga">
  <div class="overlay-content">
    <div class="spinner"></div>
    <p id="mensajeCarga">Guardando registro...</p>
  </div>
</div>

<div id="modalNuevo" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Nuevo Registro JIAT</h2>
      <span class="close" onclick="cerrarModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formNuevo">
        <div class="seccion" id="seccionCabecera">
          <div class="seccion-titulo">📋 Paso 1: Datos Principales del Accidente</div>
          
          <div class="mensaje-info">
            💡 <strong>Importante:</strong> Primero guarde los datos principales. Luego podrá agregar conclusiones, causas y recomendaciones.
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Número <span class="required">*</span></label>
              <input type="number" id="numero" min="1" required>
            </div>

            <div class="form-group">
              <label>Periodo <span class="required">*</span></label>
              <select id="periodo" required onchange="actualizarRangoFechas()">
                <option value="">Seleccione un año</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha <span class="required">*</span></label>
              <input type="date" id="fecha" required>
            </div>

            <div class="form-group">
              <label>Lugar <span class="required">*</span></label>
              <input type="text" id="lugar" required>
            </div>
          </div>

          <div class="form-group">
            <label>Involucrado(s) <span class="required">*</span></label>
            <div id="involucradosContainer" class="involucrados-container">
              <div class="involucrado-item">
                <input type="text" class="involucrado-input" placeholder="Nombre del involucrado" required>
              </div>
            </div>
            <button type="button" class="btn-agregar-involucrado" onclick="agregarInvolucrado()">+ Agregar Involucrado</button>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fatal <span class="required">*</span></label>
              <select id="fatal" required>
                <option value="">Seleccione</option>
                <option value="SÍ">SÍ</option>
                <option value="NO">NO</option>
              </select>
            </div>

            <div class="form-group">
              <label>Cant. Fatalidades <span class="required">*</span></label>
              <input type="number" id="cantfall" min="0" value="0" required>
            </div>
          </div>

          <div class="form-group">
            <label>Descripción del Accidente <span class="required">*</span></label>
            <textarea id="descripcion" required></textarea>
          </div>

          <button type="button" class="btn-guardar-cabecera" onclick="guardarCabecera()" id="btnGuardarCabecera">
            💾 Guardar Datos Principales
          </button>
        </div>

        <div class="seccion bloqueada" id="seccionDetalles">
          <div class="seccion-titulo">📝 Paso 2: Detalles - Conclusiones, Causas y Recomendaciones</div>
          
          <div class="mensaje-info" id="mensajeBloqueo">
            🔒 Esta sección se habilitará después de guardar los datos principales.
          </div>
          
          <div id="detallesContainer"></div>
          
          <button type="button" class="btn-agregar-detalle" onclick="agregarDetalle()" id="btnAgregarDetalle" disabled>
            + Agregar Conclusión / Causa / Recomendación
          </button>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalCompleto()">Cerrar y Finalizar</button>
    </div>
  </div>
</div>

<script src="js/jiat.js"></script>
</body>
</html>


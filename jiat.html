<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JIAT - Informaci√≥n de las Juntas de Investigaci√≥n de Accidentes Terrestres</title>
<link rel="stylesheet" href="css/jiat.css">
</head>
<body>

<div class="container">
  <h1>JIAT - Informaci√≥n de las Juntas de Investigaci√≥n de Accidentes Terrestres</h1>
  
  <div class="buscador">
    <input type="text" id="buscar" placeholder="Buscar por unidad, c√≥digo o fecha...">
    <span class="info-registros" id="infoRegistros"></span>
  </div>

  <div class="tabla-container">
    <div class="loading" id="loading">Cargando datos...</div>
    <table id="tablaJIAT" style="display:none;">
      <thead>
        <tr>
          <th>N¬∞</th>
          <th>UNIDAD</th>
          <th>C√ìDIGO</th>
          <th>FECHA</th>
          <th>FATAL</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody id="cuerpoTabla">
      </tbody>
    </table>
  </div>

  <div class="paginacion" id="paginacion" style="display:none;"></div>
</div>

<button class="btn-flotante" onclick="nuevoRegistro()" title="Nuevo Registro">+</button>

<div id="overlayGlobal" class="overlay-carga">
  <div class="overlay-content">
    <div class="spinner"></div>
    <p id="mensajeCarga">Guardando registro...</p>
  </div>
</div>

<!-- MODAL NUEVO REGISTRO JIAT -->
<div id="modalNuevo" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Nuevo Registro JIAT</h2>
      <span class="close" onclick="cerrarModal()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formNuevo">
        <div class="seccion" id="seccionCabecera">
          <div class="seccion-titulo">üìã Paso 1: Datos Principales del Accidente</div>
          
          <div class="mensaje-info">
            üí° <strong>Importante:</strong> Primero guarde los datos principales. Luego podr√° agregar conclusiones, causas y recomendaciones.
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>N√∫mero <span class="required">*</span></label>
              <input type="number" id="numero" min="1" required>
            </div>

            <div class="form-group">
              <label>Periodo <span class="required">*</span></label>
              <select id="periodo" required onchange="actualizarRangoFechas()">
                <option value="">Seleccione un a√±o</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha <span class="required">*</span></label>
              <input type="date" id="fecha" required>
            </div>

            <div class="form-group">
              <label>Lugar <span class="required">*</span></label>
              <input type="text" id="lugar" required>
            </div>
          </div>

          <div class="form-group">
            <label>Involucrado(s) <span class="required">*</span></label>
            <div id="involucradosContainer" class="involucrados-container">
              <div class="involucrado-item">
                <input type="text" class="involucrado-input" placeholder="Nombre del involucrado" required>
              </div>
            </div>
            <button type="button" class="btn-agregar-involucrado" onclick="agregarInvolucrado()">+ Agregar Involucrado</button>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fatal <span class="required">*</span></label>
              <select id="fatal" required>
                <option value="">Seleccione</option>
                <option value="S√ç">S√ç</option>
                <option value="NO">NO</option>
              </select>
            </div>

            <div class="form-group">
              <label>Cant. Fatalidades <span class="required">*</span></label>
              <input type="number" id="cantfall" min="0" value="0" required>
            </div>
          </div>

          <div class="form-group">
            <label>Descripci√≥n del Accidente <span class="required">*</span></label>
            <textarea id="descripcion" required></textarea>
          </div>

          <button type="button" class="btn-guardar-cabecera" onclick="guardarCabecera()" id="btnGuardarCabecera">
            üíæ Guardar Datos Principales
          </button>
        </div>

        <div class="seccion bloqueada" id="seccionDetalles">
          <div class="seccion-titulo">üìù Paso 2: Detalles - Conclusiones, Causas y Recomendaciones</div>
          
          <div class="mensaje-info" id="mensajeBloqueo">
            üîí Esta secci√≥n se habilitar√° despu√©s de guardar los datos principales.
          </div>
          
          <div id="detallesContainer"></div>
          
          <button type="button" class="btn-agregar-detalle" onclick="agregarDetalle()" id="btnAgregarDetalle" disabled>
            + Agregar Conclusi√≥n / Causa / Recomendaci√≥n
          </button>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalCompleto()">Cerrar y Finalizar</button>
    </div>
  </div>
</div>

<!-- MODAL ACCIONES TOMADAS -->
<div id="modalAcciones" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2>Registrar Acciones Tomadas</h2>
      <span class="close" onclick="cerrarModalAcciones()">&times;</span>
    </div>
    <div class="modal-body">
      
      <!-- SECCI√ìN 1: INFORMACI√ìN DEL JIAT (Solo lectura) -->
      <div class="seccion info-jiat">
        <div class="seccion-titulo">üìã Informaci√≥n del JIAT</div>
        
        <div class="info-grid">
          <div class="info-item">
            <strong>C√≥digo:</strong>
            <span id="infoCodigo">-</span>
          </div>
          <div class="info-item">
            <strong>Fecha:</strong>
            <span id="infoFecha">-</span>
          </div>
          <div class="info-item">
            <strong>Unidad:</strong>
            <span id="infoUnidad">-</span>
          </div>
          <div class="info-item">
            <strong>Lugar:</strong>
            <span id="infoLugar">-</span>
          </div>
          <div class="info-item">
            <strong>Involucrado(s):</strong>
            <span id="infoInvolucrado">-</span>
          </div>
          <div class="info-item">
            <strong>Fatal:</strong>
            <span id="infoFatal">-</span>
          </div>
        </div>

        <div class="info-descripcion">
          <strong>Descripci√≥n del Accidente:</strong>
          <p id="infoDescripcion">-</p>
        </div>

        <!-- Conclusiones, Causas y Recomendaciones -->
        <div id="detallesConclusiones" style="display:none;">
          <h4>üìå Conclusiones:</h4>
          <ul id="listaConclusiones"></ul>
        </div>

        <div id="detallesCausas" style="display:none;">
          <h4>‚ö†Ô∏è Causas:</h4>
          <ul id="listaCausas"></ul>
        </div>

        <div id="detallesRecomendaciones" style="display:none;">
          <h4>üí° Recomendaciones:</h4>
          <ul id="listaRecomendaciones"></ul>
        </div>
      </div>

      <!-- SECCI√ìN 2: ACCIONES TOMADAS REGISTRADAS -->
      <div class="seccion" id="seccionAccionesRegistradas" style="display:none;">
        <div class="seccion-titulo">‚úÖ Acciones Tomadas Previamente Registradas</div>
        <div id="listaAccionesRegistradas"></div>
      </div>

      <!-- SECCI√ìN 3: REGISTRAR NUEVAS ACCIONES -->
      <div class="seccion">
        <div class="seccion-titulo">‚ûï Registrar Nueva Acci√≥n Tomada</div>
        
        <div id="accionesContainer"></div>
        
        <button type="button" class="btn-agregar-detalle" onclick="agregarAccionTomada()">
          + Agregar Acci√≥n Tomada
        </button>
      </div>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalAcciones()">Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL VER DETALLE (SOLO LECTURA) -->
<div id="modalVerDetalle" class="modal">
  <div class="modal-content" style="max-width: 900px;">
    <div class="modal-header">
      <h2>üëÅ Ver Detalle Completo del JIAT</h2>
      <span class="close" onclick="cerrarModalVerDetalle()">&times;</span>
    </div>
    <div class="modal-body">
      
      <!-- INFORMACI√ìN DEL JIAT -->
      <div class="seccion info-jiat">
        <div class="seccion-titulo">üìã Informaci√≥n del JIAT</div>
        
        <div class="info-grid">
          <div class="info-item">
            <strong>C√≥digo:</strong>
            <span id="verCodigo">-</span>
          </div>
          <div class="info-item">
            <strong>Fecha:</strong>
            <span id="verFecha">-</span>
          </div>
          <div class="info-item">
            <strong>Unidad:</strong>
            <span id="verUnidad">-</span>
          </div>
          <div class="info-item">
            <strong>Lugar:</strong>
            <span id="verLugar">-</span>
          </div>
          <div class="info-item">
            <strong>Involucrado(s):</strong>
            <span id="verInvolucrado">-</span>
          </div>
          <div class="info-item">
            <strong>Fatal:</strong>
            <span id="verFatal">-</span>
          </div>
        </div>

        <div class="info-descripcion">
          <strong>Descripci√≥n del Accidente:</strong>
          <p id="verDescripcion">-</p>
        </div>
      </div>

      <!-- CONCLUSIONES -->
      <div class="seccion" id="verSeccionConclusiones" style="display:none;">
        <div class="seccion-titulo">üìå Conclusiones</div>
        <div id="verListaConclusiones"></div>
      </div>

      <!-- CAUSAS -->
      <div class="seccion" id="verSeccionCausas" style="display:none;">
        <div class="seccion-titulo">‚ö†Ô∏è Causas</div>
        <div id="verListaCausas"></div>
      </div>

      <!-- RECOMENDACIONES -->
      <div class="seccion" id="verSeccionRecomendaciones" style="display:none;">
        <div class="seccion-titulo">üí° Recomendaciones</div>
        <div id="verListaRecomendaciones"></div>
      </div>

      <!-- ACCIONES TOMADAS -->
      <div class="seccion" id="verSeccionAcciones" style="display:none;">
        <div class="seccion-titulo">‚úÖ Acciones Tomadas</div>
        <div id="verListaAcciones"></div>
      </div>

    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalVerDetalle()">Cerrar</button>
    </div>
  </div>
</div>

<!-- MODAL EDITAR JIAT COMPLETO -->
<div id="modalEditar" class="modal">
  <div class="modal-content" style="max-width: 1000px;">
    <div class="modal-header">
      <h2>‚úèÔ∏è Editar JIAT Completo</h2>
      <span class="close" onclick="cerrarModalEditarForzado()">&times;</span>
    </div>
    <div class="modal-body">
      <form id="formEditar">
        
        <!-- SECCI√ìN 1: CABECERA EDITABLE -->
        <div class="seccion">
          <div class="seccion-titulo">üìã Datos Principales del Accidente</div>
          
          <input type="hidden" id="editCodigo">
          
          <div class="form-row">
            <div class="form-group">
              <label>N√∫mero <span class="required">*</span></label>
              <input type="number" id="editNumero" min="1" required>
            </div>

            <div class="form-group">
              <label>Periodo <span class="required">*</span></label>
              <select id="editPeriodo" required>
                <option value="">Seleccione un a√±o</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha <span class="required">*</span></label>
              <input type="date" id="editFecha" required>
            </div>

            <div class="form-group">
              <label>Lugar <span class="required">*</span></label>
              <input type="text" id="editLugar" required>
            </div>
          </div>

          <div class="form-group">
            <label>Involucrado(s) <span class="required">*</span></label>
            <textarea id="editInvolucrado" required rows="2"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fatal <span class="required">*</span></label>
              <select id="editFatal" required>
                <option value="">Seleccione</option>
                <option value="S√ç">S√ç</option>
                <option value="NO">NO</option>
              </select>
            </div>

            <div class="form-group">
              <label>Cant. Fatalidades <span class="required">*</span></label>
              <input type="number" id="editCantfall" min="0" required>
            </div>
          </div>

          <div class="form-group">
            <label>Descripci√≥n del Accidente <span class="required">*</span></label>
            <textarea id="editDescripcion" required rows="4"></textarea>
          </div>
        </div>

        <!-- SECCI√ìN 2: DETALLES EDITABLES -->
        <div class="seccion">
          <div class="seccion-titulo">üìù Conclusiones, Causas y Recomendaciones</div>
          <div id="editDetallesContainer"></div>
          <button type="button" class="btn-agregar-detalle" onclick="agregarDetalleEdicion()">
            + Agregar Nuevo Detalle
          </button>
        </div>

        <!-- SECCI√ìN 3: ACCIONES TOMADAS EDITABLES -->
        <div class="seccion">
          <div class="seccion-titulo">‚úÖ Acciones Tomadas</div>
          <div id="editAccionesContainer"></div>
        </div>

      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-cerrar" onclick="cerrarModalEditarForzado()">Cancelar</button>
      <button type="button" class="btn-guardar-cabecera" onclick="guardarEdicionCompleta()">üíæ Guardar Todos los Cambios</button>
    </div>
  </div>
</div>

<script src="js/jiat.js"></script>
</body>
</html>

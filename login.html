<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login Seguro</title>
<style>
  body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f0f0; }
  #loginForm { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 300px; }
  h2 { text-align: center; margin-bottom: 20px; }
  input { display: block; width: 100%; margin: 10px 0; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
  button { width: 100%; padding: 10px; background: #0056b3; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background: #004494; }

  /* Spinner */
  #loading { display: none; text-align: center; margin-top: 20px; }
  .spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #0056b3;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  #loading div { margin-top: 8px; color: #0056b3; }
</style>
</head>
<body>

<form id="loginForm">
  <h2>Iniciar Sesi칩n</h2>
  <input type="text" id="usuario" placeholder="Usuario" required>
  <input type="password" id="clave" placeholder="Clave" required>
  <button type="submit">Ingresar</button>
</form>

<!-- Spinner de carga -->
<div id="loading">
  <div class="spinner"></div>
  <div>Actualizando p치gina, por favor espere...</div>
</div>

<script>
document.getElementById("loginForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const usuario = document.getElementById("usuario").value.trim();
  const clave = document.getElementById("clave").value.trim();
  const loadingDiv = document.getElementById("loading");

  // Mostrar spinner y mensaje
  loadingDiv.style.display = "block";

  const url = "https://script.google.com/macros/s/AKfycbxv9MA2tQmda4RigzSs-K9h0WTXjCXAfK642SzE6k6KobWInbRy0KsvAnxcw_6V-Iut/exec";

  try {
    const response = await fetch(url, {
      method: "POST",
      body: new URLSearchParams({usuario, clave, token: "#####%%%256//&&*****"})
    });

    const result = await response.json();

    if(result.success){
      localStorage.setItem("usuario", usuario);
      localStorage.setItem("rol", result.rol);
      localStorage.setItem("correo", result.correo);

      // Redirigir con peque침o delay para que el usuario vea el spinner
      setTimeout(() => {
        window.location.href = "https://msilva-ux.github.io/prev2/#";
      }, 500);
    } else {
      loadingDiv.style.display = "none"; // ocultar spinner si error
      alert("Usuario o clave incorrectos");
    }
  } catch(err){
    loadingDiv.style.display = "none";
    console.error(err);
    alert("Error de conexi칩n. Intente nuevamente.");
  }
});
</script>

</body>
</html>

  
